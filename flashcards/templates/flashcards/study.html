{% extends 'flashcards/layout.html' %}

{% block content %}
<div class="d-flex justify-content-center align-items-center min-vh-100">
  <div class="text-center w-100 px-3">

    <!-- Deck title -->
    <h3 class="mb-4">{{ deck.name }}</h3>

    <!-- Flashcard Container -->
    <div class="flashcard-container mb-4">
      <div class="flashcard" id="flashcard">
        <div class="front">
          <p class="fs-5" id="card-front">{{ card.front }}</p>
        </div>
        <div class="back">
          <p class="fs-5" id="card-back">{{ card.back }}</p>
        </div>
      </div>
    </div>

    <!-- Difficulty Buttons -->
    <div class="d-flex flex-wrap justify-content-center gap-2">
      <button onclick="submitAnswer('again')" class="btn btn-primary">Again</button>
      <button onclick="submitAnswer('hard')" class="btn btn-warning">Hard</button>
      <button onclick="submitAnswer('medium')" class="btn btn-secondary">Medium</button>
      <button onclick="submitAnswer('easy')" class="btn btn-success">Easy</button>
    </div>

    <div style="margin-top:40px;">
        <a href="{% url 'viewDeck' deck.id %}" class="btn btn-danger">Quit</a>
    </div>

  </div>
</div>

<!-- JavaScript -->
<script>
  const flashcard = document.getElementById("flashcard");

  flashcard.addEventListener("click", () => {
    flashcard.classList.toggle("flipped");
  });

  function submitAnswer(difficulty) {
    fetch(window.location.href, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-CSRFToken': '{{ csrf_token }}',
        'X-Requested-With': 'XMLHttpRequest'
      },
      body: `difficulty=${difficulty}`
    })
    .then(response => response.json())
    .then(data => {
      if (data.done) {
        alert("You've finished this deck!");
        window.location.href = `{% url 'viewDeck' deck.id %}`;
        return;
      }

      // reset flip and update content
      flashcard.classList.remove("flipped");
      document.getElementById("card-front").innerText = data.front;
      document.getElementById("card-back").innerText = data.back;
    })
    .catch(error => {
      console.error("Error updating card:", error);
    });
  }
</script>

<!-- Styling -->
<style>
  .flashcard-container {
    perspective: 1000px;
    width: 90vw;
    max-width: 500px;
    height: 60vh;
    max-height: 350px;
    margin: auto;
  }

  .flashcard {
    width: 100%;
    height: 100%;
    position: relative;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    cursor: pointer;
  }

  .flashcard.flipped {
    transform: rotateY(180deg);
  }

  .flashcard .front,
  .flashcard .back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    background-color: white;
    border: 1px solid #ccc;
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.2rem;
    text-align: center;
    overflow-wrap: break-word;
  }

  .flashcard .back {
    transform: rotateY(180deg);
  }
</style>
{% endblock %}
